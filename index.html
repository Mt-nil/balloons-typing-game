<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Balloon Pop Typing Game - Final v1.0</title>
<meta property="og:title" content="üéà Balloon Pop Master">
<meta property="og:description" content="Fast balloon popping game.  Pop fast, build combos, and chase high scores!">
<meta property="og:image" content="https://mt-nil.github.io/balloons-typing-game/preview.png">
<meta property="og:url" content="https://mt-nil.github.io/balloons-typing-game/">
<meta property="og:type" content="website">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#c62828">

<style>
  body { margin:0; font-family: 'Arial Black', sans-serif; background:#050505; color:#fff; overflow:hidden; touch-action: manipulation; }
  .screen { position:absolute; inset:0; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:20px; background: rgba(0,0,0,0.95); z-index: 200; text-align: center; }
  #gameArea { position:absolute; inset:0; display:none; background: radial-gradient(circle, #111 0%, #000 100%); overflow: hidden; }
  
  button { padding:12px 20px; font-size:16px; cursor:pointer; border-radius: 12px; border: none; color: white; font-weight: bold; transition: 0.2s; }
  .btn-start { background: #2ed573; width: 180px; font-size: 20px; margin: 5px; }
  .btn-ui { padding: 10px 15px; font-size: 18px; }
  .btn-share { background: #25D366; margin-top: 10px; width: 100%; } /* WhatsApp Green */

  #topControls { position:fixed; top:10px; width: 100%; display: flex; justify-content: center; gap: 10px; z-index: 150; }
  #hud { position:fixed; bottom:20px; left:0; right:0; display:flex; justify-content: center; gap:12px; z-index: 100; pointer-events: none; flex-wrap: wrap; }
  .stat-box { background: rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(10px); font-size: 14px; }
  .combo-alert { color: #fffa65; font-weight: 900; text-shadow: 0 0 10px #ffa502; }

  .balloon-container { position: absolute; bottom: -150px; width: 70px; height: 150px; z-index: 10; }
  .balloon-body { 
    position:absolute; top:0; width:70px; height:85px; border-radius:50%; 
    display:flex; justify-content:center; align-items:center; 
    font-size:36px; font-weight:900; color:#fff; 
    text-shadow: 2px 2px 0px #000; z-index: 2;
    box-shadow: inset -5px -10px 20px rgba(0,0,0,0.5);
  }
  .string-line { position: absolute; top: 80px; left: 50%; width: 2px; height: 65px; background: rgba(255,255,255,0.4); transform: translateX(-50%); z-index: 1; }
  .particle { position: absolute; width: 8px; height: 8px; border-radius: 50%; pointer-events: none; z-index: 50; }

  #comboPopup {
      position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%);
      font-size: 3rem; font-weight: 900; color: #fffa65; 
      text-shadow: 0 0 15px #ffa502, 3px 3px 0px #ff4757;
      z-index: 300; pointer-events: none; opacity: 0; font-style: italic;
  }
  .strike-animate { animation: strikePop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
  @keyframes strikePop {
      0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
      30% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
      100% { transform: translate(-50%, -60%) scale(1); opacity: 0; }
  }
</style>
</head>
<body>

<div id="menu" class="screen">
  <h1 style="font-size: 3rem; color: #ff4757; margin: 0;">üéà POP MASTER</h1>
  <button class="btn-start" onclick="startGame('easy')">Easy</button>
  <button class="btn-start" onclick="startGame('medium')" style="background:#eccc68">Medium</button>
  <button class="btn-start" onclick="startGame('hard')" style="background:#ff4757">Hard</button>
</div>

<div id="gameOverScreen" class="screen" style="display:none;">
  <h1 style="color:#ff4757; font-size: 3rem;">GAME OVER</h1>
  <div id="finalStats" style="font-size: 1.2rem; margin-bottom: 10px;"></div>
  <div style="display: flex; flex-direction: column; gap: 10px; width: 220px;">
    <div style="display: flex; gap: 10px;">
        <button style="background:#ffa502; flex:1;" onclick="startGame(currentLevel)">üîÑ Restart</button>
        <button style="background:#1e90ff; flex:1;" onclick="goHome()">üè† Home</button>
    </div>
    <button class="btn-share" onclick="shareScore()">üì§ Share Score</button>
  </div>
</div>

<div id="gameArea"></div>
<div id="comboPopup"></div>

<div id="topControls" style="display: none;">
  <button class="btn-ui" style="background:#ffa502;" onclick="startGame(currentLevel)">üîÑ</button>
  <button class="btn-ui" style="background:#747d8c;" id="pauseBtn">‚è∏</button>
  <button class="btn-ui" style="background:#1e90ff;" onclick="goHome()">üè†</button>
</div>

<div id="hud" style="display:none;">
  <div class="stat-box">Score: <span id="score">0</span></div>
  <div class="stat-box">Best (<span id="levelNameHUD">Easy</span>): <span id="highScoreText">0</span></div>
  <div class="stat-box combo-alert">Combo: x<span id="combo">0</span></div>
  <div class="stat-box">Acc: <span id="accuracy">100</span>%</div>
  <div class="stat-box" style="color:#ff4757">Miss: <span id="wrong">0</span>/10</div>
</div>

<script>
let gameRunning = false, isPaused = false, currentLevel = 'easy';
let balloons = [], spawnInterval = null, score = 0, wrong = 0, speed = 2, spawnRate = 1500;
let totalTyped = 0, correctTyped = 0, correctInRow = 0, comboLevel = 0;
let highScore = 0, isRecordBroken = false;

// Sounds
const popSound = new Audio('https://www.gstatic.com');
const comboSound = new Audio('https://assets.mixkit.co');

const gameArea = document.getElementById('gameArea'), scoreEl = document.getElementById('score');
const accEl = document.getElementById('accuracy'), comboEl = document.getElementById('combo');
const wrongEl = document.getElementById('wrong'), menu = document.getElementById('menu');
const hud = document.getElementById('hud'), pauseBtn = document.getElementById('pauseBtn');
const comboPopupEl = document.getElementById('comboPopup');
const highScoreText = document.getElementById('highScoreText');
const levelNameHUD = document.getElementById('levelNameHUD');
const topControls = document.getElementById('topControls'), gameOverScreen = document.getElementById('gameOverScreen');

function startGame(level) {
  currentLevel = level;
  highScore = localStorage.getItem('highScore_' + currentLevel) || 0;
  levelNameHUD.textContent = currentLevel.charAt(0).toUpperCase() + currentLevel.slice(1);
  
  clearInterval(spawnInterval);
  resetGame();
  
  if(level === 'easy') { speed = 1.8; spawnRate = 1600; }
  if(level === 'medium') { speed = 3.2; spawnRate = 1100; }
  if(level === 'hard') { speed = 5.5; spawnRate = 750; }

  menu.style.display = 'none';
  gameOverScreen.style.display = 'none';
  gameArea.style.display = 'block';
  hud.style.display = 'flex';
  topControls.style.display = 'flex';

  gameRunning = true;
  isPaused = false;
  isRecordBroken = false;
  spawnInterval = setInterval(createBalloon, spawnRate);
  requestAnimationFrame(update);
}

function resetGame() {
  gameArea.innerHTML = "";
  balloons = [];
  score = 0; wrong = 0; correctInRow = 0; comboLevel = 0;
  totalTyped = 0; correctTyped = 0;
  updateHUD();
}

function createBalloon() {
  if (!gameRunning || isPaused) return;
  const char = String.fromCharCode(65 + Math.floor(Math.random() * 26));
  const container = document.createElement('div');
  container.className = 'balloon-container';
  const body = document.createElement('div');
  body.className = 'balloon-body';
  body.textContent = char;
  const string = document.createElement('div');
  string.className = 'string-line';
  const hue = Math.floor(Math.random() * 360);
  body.style.background = `radial-gradient(circle at 30% 30%, hsl(${hue}, 85%, 65%), hsl(${hue}, 85%, 35%))`;
  container.appendChild(string);
  container.appendChild(body);
  container.addEventListener('pointerdown', (e) => {
    if (isPaused) return;
    totalTyped++;
    popBalloon(container);
  });
  container.style.left = Math.random() * (window.innerWidth - 80) + 'px';
  gameArea.appendChild(container);
  balloons.push({ container, body, char, y: -150 });
}

function popBalloon(container) {
  const index = balloons.findIndex(b => b.container === container);
  if (index > -1) {
    const b = balloons[index];
    createParticles(parseFloat(container.style.left) + 35, window.innerHeight - b.y - 45, b.body.style.background);
    popSound.currentTime = 0;
    popSound.play().catch(()=>{});
    container.remove();
    balloons.splice(index, 1);
    correctTyped++;
    correctInRow++;
    let oldCombo = comboLevel;
    comboLevel = Math.floor(correctInRow / 10);
    if (comboLevel > oldCombo && comboLevel > 0) {
        showComboPopup(`COMBO STRIKE ${comboLevel}`);
        comboSound.play().catch(()=>{});
    }
    score += (1 + comboLevel);
    updateHUD();
  }
}

function updateHUD() {
  scoreEl.textContent = score;
  wrongEl.textContent = wrong;
  comboEl.textContent = comboLevel;
  highScoreText.textContent = highScore;

  if (highScore > 0 && score > highScore && !isRecordBroken) {
    showComboPopup("NEW HIGH SCORE!");
    isRecordBroken = true;
  }

  if (score > highScore) {
    highScore = score;
    localStorage.setItem('highScore_' + currentLevel, highScore);
  }
  let acc = totalTyped > 0 ? Math.round((correctTyped / totalTyped) * 100) : 100;
  accEl.textContent = acc;
}

function showComboPopup(text) {
    comboPopupEl.textContent = text;
    comboPopupEl.style.display = 'block';
    comboPopupEl.classList.remove('strike-animate');
    void comboPopupEl.offsetWidth; 
    comboPopupEl.classList.add('strike-animate');
}

function update() {
  if (!gameRunning || isPaused) {
    if(gameRunning) requestAnimationFrame(update);
    return;
  }
  for (let i = balloons.length - 1; i >= 0; i--) {
    let b = balloons[i];
    b.y += speed;
    b.container.style.bottom = b.y + 'px';
    if (b.y > window.innerHeight + 150) {
      b.container.remove();
      balloons.splice(i, 1);
      wrong++;
      correctInRow = 0;
      updateHUD();
      if (wrong >= 10) showGameOver();
    }
  }
  requestAnimationFrame(update);
}

function showGameOver() {
  gameRunning = false;
  clearInterval(spawnInterval);
  document.getElementById('finalStats').innerHTML = `Score: ${score} | Best (${currentLevel}): ${highScore} | Acc: ${accEl.textContent}%`;
  gameOverScreen.style.display = 'flex';
  topControls.style.display = 'none';
  hud.style.display = 'none';
}

async function shareScore() {

    const text =
`üéà BALLOON POP MASTER
üèÜ Score: ${score}
üéØ Accuracy: ${accEl.textContent}%
üî• Max Combo: Strike ${comboLevel}

Khel kar dekho üëá
https://mt-nil.github.io/balloons-typing-game/`;

    // ‚úÖ CASE 1: Image + Text supported
    if (
        navigator.canShare &&
        navigator.canShare({ files: [new File([], 'test.png')] })
    ) {
        try {
            const imageFile = await generateScoreImage();
            await navigator.share({
                title: 'Balloon Pop Master',
                text: text,
                files: [imageFile]
            });
            return;
        } catch (e) {
            console.log("Image share failed, fallback to text");
        }
    }

    // ‚úÖ CASE 2: Normal SHARE SHEET (TEXT ONLY)
    if (navigator.share) {
        navigator.share({
            title: 'Balloon Pop Master',
            text: text
        }).catch(() => {});
    } else {
        // last fallback (very old browsers)
        alert("Sharing not supported on this device");
    }
}

function goHome() {
  gameRunning = false; clearInterval(spawnInterval);
  menu.style.display = 'flex'; gameOverScreen.style.display = 'none';
  gameArea.style.display = 'none'; hud.style.display = 'none'; topControls.style.display = 'none';
}

document.addEventListener('keydown', (e) => {
  if (!gameRunning || isPaused) return;
  const key = e.key.toUpperCase();
  if(key.length !== 1) return;
  totalTyped++;
  const b = balloons.find(b => b.char === key);
  if (b) popBalloon(b.container);
  else { correctInRow = 0; score = Math.max(0, score - 2); updateHUD(); }
});

pauseBtn.addEventListener('click', () => {
  isPaused = !isPaused;
  pauseBtn.textContent = isPaused ? '‚ñ∂' : '‚è∏';
});

function createParticles(x, y, color) {
  for (let i = 0; i < 12; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.style.left = x + 'px'; p.style.top = y + 'px'; p.style.background = color;
    gameArea.appendChild(p);
    const angle = Math.random() * Math.PI * 2, velocity = Math.random() * 6 + 2;
    let px = x, py = y, op = 1;
    const move = () => {
      px += Math.cos(angle) * velocity; py += Math.sin(angle) * velocity;
      op -= 0.04; p.style.left = px + 'px'; p.style.top = py + 'px'; p.style.opacity = op;
      if (op > 0) requestAnimationFrame(move); else p.remove();
    };
    requestAnimationFrame(move);
  }
}

async function generateScoreImage() {
    const canvas = document.getElementById('scoreCanvas');
    const ctx = canvas.getContext('2d');

    const W = canvas.width;
    const H = canvas.height;

    // ---------- Background ----------
    ctx.fillStyle = '#0b0b0b';
    ctx.fillRect(0, 0, W, H);

    const glow = ctx.createRadialGradient(
        W / 2, H / 3, 100,
        W / 2, H / 3, 700
    );
    glow.addColorStop(0, '#ff4757');
    glow.addColorStop(1, '#000');
    ctx.fillStyle = glow;
    ctx.fillRect(0, 0, W, H);

    ctx.textAlign = 'center';

    // ---------- Title ----------
    ctx.fillStyle = '#ffffff';
    ctx.font = 'bold 80px Arial Black';
    ctx.fillText('üéà BALLOON POP MASTER', W / 2, 160);

    // ---------- SCORE ----------
    ctx.fillStyle = '#ffa502';
    ctx.font = 'bold 60px Arial';
    ctx.fillText('SCORE', W / 2, 340);

    ctx.font = 'bold 220px Arial Black';
    ctx.fillText(score, W / 2, 560);

    // ---------- Accuracy ----------
    ctx.font = 'bold 54px Arial';
    ctx.fillStyle = '#2ed573';
    ctx.fillText(`üéØ Accuracy: ${accEl.textContent}%`, W / 2, 720);

    // ---------- Combo ----------
    ctx.fillStyle = '#ff6b81';
    ctx.fillText(`üî• Max Combo: Strike ${comboLevel}`, W / 2, 800);

    // ---------- Divider ----------
    ctx.strokeStyle = 'rgba(255,255,255,0.2)';
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(200, 860);
    ctx.lineTo(W - 200, 860);
    ctx.stroke();

    // ---------- CTA ----------
    ctx.font = '48px Arial';
    ctx.fillStyle = '#70a1ff';
    ctx.fillText('Khel kar dekho üëá', W / 2, 980);

    ctx.font = '42px Arial';
    ctx.fillText(
        'https://mt-nil.github.io/balloons-typing-game/',
        W / 2,
        1050
    );

    // ---------- Convert to File ----------
    return new Promise(resolve => {
        canvas.toBlob(blob => {
            const file = new File(
                [blob],
                'balloon-score.png',
                { type: 'image/png' }
            );
            resolve(file);
        });
    });
}
</script>
<canvas id="scoreCanvas" width="1080" height="1350" style="display:none;"></canvas>
</body>
</html>
